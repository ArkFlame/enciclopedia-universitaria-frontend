<!-- default.html -->
<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="description" content="{{ page.description | default: site.description }}">
  <title>{% if page.title %}{{ page.title }} — {% endif %}{{ site.title }}</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  {% if page.custom_css %}<link rel="stylesheet" href="{{ page.custom_css | relative_url }}">{% endif %}

  <!-- MercadoPago SDK (solo páginas de pago) -->
  {% if page.use_mercadopago %}
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  {% endif %}

  <!-- EU_CONFIG + Theme init: inline, runs before any external script or Rocket Loader -->
  <script data-cfasync="false">
    // Config
    window.EU_CONFIG = {
      backendUrl: window.location.origin,
      baseUrl:    window.location.origin
    };

    // Theme: apply immediately to prevent flash
    (function() {
      var t = localStorage.getItem('eu_theme') || 'light';
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>

</head>
<body>

  <!-- NAVBAR -->
  <nav class="eu-navbar" id="mainNavbar">
    <div class="eu-navbar-inner">

      <!-- Logo -->
      <a href="{{ '/' | relative_url }}" class="eu-logo">
        <span class="eu-logo-icon">Σ</span>
        <span class="eu-logo-text">Enciclopedia<br><strong>Universitaria</strong></span>
      </a>

      <!-- Búsqueda desktop -->
      <div class="eu-search-wrapper d-none d-md-flex">
        <div class="eu-search-box">
          <i class="bi bi-search eu-search-icon"></i>
          <input type="text" id="globalSearch" placeholder="Buscar artículos..."
                 class="eu-search-input" autocomplete="off" aria-label="Buscar artículos">
          <div class="eu-search-dropdown" id="searchDropdown"></div>
        </div>
      </div>

      <!-- Controles derechos -->
      <div class="eu-navbar-right">

        <!-- Toggle pendientes -->
        <div class="eu-toggle-wrap d-none d-sm-flex align-items-center gap-2">
          <label class="eu-ios-toggle" title="Ver artículos sin aprobación">
            <input type="checkbox" id="togglePending">
            <span class="eu-toggle-slider"></span>
          </label>
          <span class="eu-toggle-label d-none d-lg-inline">Sin aprobación</span>
        </div>

        <!-- Dark mode -->
        <button class="eu-icon-btn" id="themeToggle" title="Cambiar tema" aria-label="Cambiar tema">
          <i class="bi bi-moon-fill" id="themeIcon"></i>
        </button>

        <!-- Notificaciones -->
        <div class="eu-notif-wrap d-none" id="notifWrapper">
          <button class="eu-icon-btn eu-notif-btn" id="notifBtn" aria-label="Notificaciones">
            <i class="bi bi-bell-fill"></i>
            <span class="eu-notif-badge d-none" id="notifBadge">0</span>
          </button>
          <div class="eu-notif-dropdown" id="notifDropdown">
            <div class="eu-notif-header">
              <span>Notificaciones</span>
              <button class="btn btn-sm" id="markAllRead" style="color:var(--eu-text-secondary);border:1px solid var(--eu-border);background:var(--eu-bg-secondary);border-radius:var(--eu-radius);padding:2px 10px;font-size:.78rem">Marcar leídas</button>
            </div>
            <div class="eu-notif-list" id="notifList">
              <div class="eu-notif-empty">No hay notificaciones</div>
            </div>
          </div>
        </div>

        <!-- Contador artículos FREE -->
        <div class="eu-read-counter d-none" id="readCounter" title="Artículos leídos este mes">
          <i class="bi bi-journal-text"></i>
          <span id="readCountText">0/30</span>
        </div>

        <!-- Auth section -->
        <div id="authSection">
          <a href="{{ '/login.html' | relative_url }}" class="eu-btn-primary">Iniciar sesión</a>
        </div>

        <!-- Hamburger -->
        <button class="eu-hamburger d-md-none" id="hamburgerBtn" aria-label="Menú">
          <span></span><span></span><span></span>
        </button>

      </div>
    </div>

    <!-- Búsqueda móvil -->
    <div class="eu-mobile-search d-md-none px-3 pb-2">
      <div class="eu-search-box w-100">
        <i class="bi bi-search eu-search-icon"></i>
        <input type="text" id="mobileSearch" placeholder="Buscar artículos..."
               class="eu-search-input" autocomplete="off" aria-label="Buscar artículos">
        <div class="eu-search-dropdown" id="mobileSearchDropdown"></div>
      </div>
    </div>
  </nav>

  <!-- SIDEBAR MÓVIL -->
  <div class="eu-sidebar-overlay d-md-none" id="sidebarOverlay"></div>
  <aside class="eu-mobile-sidebar d-md-none" id="mobileSidebar">
    <div class="eu-sidebar-header">
      <span class="eu-logo-text">Menú</span>
      <button class="eu-icon-btn" id="closeSidebar" aria-label="Cerrar menú"><i class="bi bi-x-lg"></i></button>
    </div>
    <nav class="eu-sidebar-nav">
      <a href="{{ '/' | relative_url }}"><i class="bi bi-house"></i> Inicio</a>
      <a href="{{ '/categorias.html' | relative_url }}"><i class="bi bi-grid"></i> Categorías</a>
      <a href="{{ '/acerca.html' | relative_url }}"><i class="bi bi-info-circle"></i> Acerca de</a>
      <div class="eu-sidebar-divider"></div>
      <a href="{{ '/nuevo-articulo.html' | relative_url }}" id="sidebarNewArticle" class="d-none">
        <i class="bi bi-plus-circle"></i> Nuevo artículo
      </a>
      <div class="eu-sidebar-toggle-row">
        <span>Ver sin aprobación</span>
        <label class="eu-ios-toggle">
          <input type="checkbox" id="togglePendingMobile">
          <span class="eu-toggle-slider"></span>
        </label>
      </div>
      <div class="eu-sidebar-divider"></div>
      <div id="sidebarAuthSection"></div>
    </nav>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="eu-main">
    {{ content }}
  </main>

  <!-- FOOTER -->
  <footer class="eu-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4">
          <div class="eu-logo mb-3">
            <span class="eu-logo-icon">Σ</span>
            <span class="eu-logo-text">Enciclopedia<br><strong>Universitaria</strong></span>
          </div>
          <p class="text-muted small">La enciclopedia colaborativa universitaria más avanzada de habla hispana.</p>
        </div>
        <div class="col-md-2 mb-4">
          <h6 class="eu-footer-heading">Navegación</h6>
          <ul class="eu-footer-links">
            <li><a href="{{ '/' | relative_url }}">Inicio</a></li>
            <li><a href="{{ '/categorias.html' | relative_url }}">Categorías</a></li>
            <li><a href="{{ '/acerca.html' | relative_url }}">Acerca de</a></li>
          </ul>
        </div>
        <div class="col-md-2 mb-4">
          <h6 class="eu-footer-heading">Comunidad</h6>
          <ul class="eu-footer-links">
            <li><a href="{{ '/nuevo-articulo.html' | relative_url }}">Publicar artículo</a></li>
            <li><a href="{{ '/busqueda.html' | relative_url }}">Buscar</a></li>
            <li><a href="{{ '/shortcodes.html' | relative_url }}">Guía shortcodes</a></li>
          </ul>
        </div>
        <div class="col-md-4 mb-4">
          <h6 class="eu-footer-heading">Suscripción</h6>
          <p class="small text-muted">Accede a artículos ilimitados por solo <strong>$1.000 ARS/mes</strong></p>
          <a href="{{ '/suscripcion.html' | relative_url }}" class="eu-btn-primary eu-btn-sm">Ver planes</a>
        </div>
      </div>
      <div class="eu-footer-bottom">
        <span class="text-muted small">© {{ 'now' | date: "%Y" }} Enciclopedia Universitaria. Contenido bajo licencia CC BY-SA.</span>
      </div>
    </div>
  </footer>

  <!-- TOAST -->
  <div class="eu-toast-container" id="toastContainer"></div>

  <!-- Theme toggle: inline so it cannot be deferred/intercepted by Rocket Loader or caching -->
  <script data-cfasync="false">
    (function() {
      var LOG = '[Theme]';
      function getTheme() { return localStorage.getItem('eu_theme') || 'light'; }
      function applyTheme(t) {
        console.log(LOG, 'applyTheme ->', t);
        document.documentElement.setAttribute('data-theme', t);
        localStorage.setItem('eu_theme', t);
        var icon = document.getElementById('themeIcon');
        if (icon) {
          icon.className = t === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
        } else {
          console.warn(LOG, '#themeIcon not found');
        }
      }
      var btn = document.getElementById('themeToggle');
      if (btn) {
        console.log(LOG, '#themeToggle found, attaching listener');
        btn.addEventListener('click', function() {
          console.log(LOG, 'click! current theme:', getTheme());
          applyTheme(getTheme() === 'dark' ? 'light' : 'dark');
        });
        applyTheme(getTheme());
      } else {
        console.error(LOG, 'CRITICAL: #themeToggle not found! Cannot attach theme toggle.');
      }
      window._applyTheme = applyTheme;
    })();
  </script>

  <!-- External scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous" data-cfasync="false"></script>
  <script src="{{ '/assets/js/auth.js' | relative_url }}" data-cfasync="false"></script>
  <script src="{{ '/assets/js/search.js' | relative_url }}" data-cfasync="false"></script>
  <script src="{{ '/assets/js/mediaManager.js' | relative_url }}" data-cfasync="false"></script>
  <script src="{{ '/assets/js/mapaSinoptico.js' | relative_url }}" data-cfasync="false"></script>
  <script src="{{ '/assets/js/app.js' | relative_url }}" data-cfasync="false"></script>
  {% if page.extra_js %}<script src="{{ page.extra_js | relative_url }}" data-cfasync="false"></script>{% endif %}

</body>
</html>